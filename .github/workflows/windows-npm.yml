name: 'Tests on Windows: `nvm install`'

on: [pull_request, push]

env:
  NVM_INSTALL_GITHUB_REPO: ${{ github.repository }}
  NVM_INSTALL_VERSION: ${{ github.ref }}
  NVM_INSTALL_SHA: ${{ github.sha }}

jobs:
  node_fail_install:
    # Default installation does not work due to npm_config_prefix set to C:\npm\prefix
    name: 'MSYS fail prefix nvm install'
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - name: Retrieve nvm
        shell: bash
        run: |
          env | sort
          env | sort | grep NVM_INSTALL
          export NVM_INSTALL_VERSION="$NVM_INSTALL_SHA"
          curl -fsSLo- "https://raw.githubusercontent.com/${NVM_INSTALL_GITHUB_REPO}/${NVM_INSTALL_SHA}/install.sh" | METHOD=script bash
          # Cannot source as below as it does not seem possible to clone the repo with the current PR content
          # . "$HOME/.nvm/nvm.sh"
          . ./nvm.sh
          ! nvm install --lts
